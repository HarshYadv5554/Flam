<!DOCTYPE html>
<html>
<head>
    <title>Metrics Test - Edge Detection</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 { 
            color: #333; 
            text-align: center; 
            margin-bottom: 30px;
        }
        .metrics { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; 
            margin: 30px 0; 
        }
        .metric-card { 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 10px; 
            text-align: center; 
            border: 2px solid #e9ecef; 
        }
        .metric-value { 
            font-size: 2em; 
            font-weight: bold; 
            color: #007bff; 
            margin-bottom: 10px; 
        }
        .metric-label { 
            font-size: 1.1em; 
            color: #6c757d; 
        }
        button { 
            padding: 15px 30px; 
            margin: 10px; 
            font-size: 18px; 
            background: #4CAF50; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
        }
        button:hover { 
            background: #45a049; 
        }
        .status { 
            padding: 15px; 
            margin: 20px 0; 
            border-radius: 8px; 
            font-size: 16px; 
            text-align: center; 
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
        }
        .info { 
            background: #d1ecf1; 
            color: #0c5460; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Metrics Test - Edge Detection</h1>
        <p style="text-align: center; color: #666;">
            This page tests the metrics functionality to ensure all values are updating correctly
        </p>
        
        <div class="status info" id="status">Click "Test Metrics" to verify all metrics are working...</div>
        
        <div class="metrics">
            <div class="metric-card">
                <div class="metric-value" id="totalFrames">0</div>
                <div class="metric-label">Total Frames</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="currentFPS">0</div>
                <div class="metric-label">Current FPS</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="avgProcessing">0</div>
                <div class="metric-label">Avg Processing (ms)</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="connectedClients">0</div>
                <div class="metric-label">Connected Clients</div>
            </div>
        </div>
        
        <div style="text-align: center; margin: 30px 0;">
            <button onclick="testMetrics()">üîç Test Metrics</button>
            <button onclick="startAutoUpdate()">‚ñ∂Ô∏è Start Auto Update</button>
            <button onclick="stopAutoUpdate()">‚èπÔ∏è Stop Auto Update</button>
        </div>
    </div>
    
    <script>
        let autoUpdateInterval;
        let frameCount = 0;
        
        function testMetrics() {
            console.log('=== TESTING METRICS ===');
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = 'Testing metrics...';
            statusDiv.className = 'status info';
            
            // Test all metrics
            updateMetrics();
            
            statusDiv.textContent = '‚úÖ Metrics test completed! All values should be updating.';
            statusDiv.className = 'status success';
        }
        
        function updateMetrics() {
            console.log('Updating metrics...');
            
            // Update FPS counter
            const fps = Math.floor(Math.random() * 30) + 10; // Simulate 10-40 FPS
            document.getElementById('currentFPS').textContent = fps;
            
            // Update processing time (always show a value)
            const processingTime = (Math.random() * 50 + 10).toFixed(1); // 10-60ms
            document.getElementById('avgProcessing').textContent = processingTime;
            
            // Update connected clients (simulate WebSocket connections)
            const clients = Math.floor(Math.random() * 3) + 1; // 1-3 clients
            document.getElementById('connectedClients').textContent = clients;
            
            // Update frame count
            frameCount += Math.floor(Math.random() * 5) + 1;
            document.getElementById('totalFrames').textContent = frameCount;
            
            console.log(`Metrics updated: FPS=${fps}, Processing=${processingTime}ms, Clients=${clients}, Frames=${frameCount}`);
        }
        
        function startAutoUpdate() {
            if (autoUpdateInterval) return;
            
            console.log('Starting auto-update...');
            autoUpdateInterval = setInterval(updateMetrics, 1000); // Update every second
            
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = '‚úÖ Auto-update started! Metrics updating every second.';
            statusDiv.className = 'status success';
        }
        
        function stopAutoUpdate() {
            if (autoUpdateInterval) {
                clearInterval(autoUpdateInterval);
                autoUpdateInterval = null;
                
                const statusDiv = document.getElementById('status');
                statusDiv.textContent = '‚èπÔ∏è Auto-update stopped.';
                statusDiv.className = 'status info';
            }
        }
        
        // Initialize on page load
        window.addEventListener('load', function() {
            console.log('Page loaded, initializing metrics...');
            updateMetrics();
        });
    </script>
</body>
</html>
